<!DOCTYPE html>
<html>
<head>
    <title>Localisation Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        let map;
        let marker;
        
        // Initialiser la carte
        map = L.map('map').setView([48.8566, 2.3522], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        class NetworkLocationService {
            constructor() {
                this.wifiNetworks = [];
                this.cellTowers = [];
            }

            async getLocation() {
                try {
                    // Obtenir les informations des réseaux WiFi à proximité
                    if ('networkInformation' in navigator) {
                        const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                        console.log('Type de connexion:', connection.type);
                        console.log('Opérateur:', connection.effectiveType);
                    }

                    // Obtenir les informations des antennes cellulaires (nécessite des permissions spéciales)
                    if ('permissions' in navigator) {
                        const status = await navigator.permissions.query({ name: 'geolocation' });
                        if (status.state === 'granted') {
                            // Utiliser l'API Network Information
                            const connection = navigator.connection;
                            if (connection) {
                                console.log('MCC:', connection.mcc);
                                console.log('MNC:', connection.mnc);
                            }
                        }
                    }

                    // Simuler la triangulation (dans un vrai cas, ces données viendraient du réseau)
                    const position = await this.triangulatePosition();
                    return position;
                } catch (error) {
                    console.error('Erreur lors de la localisation:', error);
                    throw error;
                }
            }

            async triangulatePosition() {
                // Simulation de triangulation - Dans la réalité, ceci nécessiterait
                // un accès direct aux données des antennes cellulaires
                return {
                    latitude: 48.8566,
                    longitude: 2.3522,
                    accuracy: 100,
                    source: 'network_triangulation'
                };
            }
        }

        // Utilisation du service
        const locationService = new NetworkLocationService();
        locationService.getLocation()
            .then(position => {
                const pos = {
                    lat: position.latitude,
                    lng: position.longitude
                };
                
                map.setView([pos.lat, pos.lng], 15);
                
                if (marker) {
                    marker.setLatLng([pos.lat, pos.lng]);
                } else {
                    marker = L.marker([pos.lat, pos.lng]).addTo(map);
                }

                console.log("Position obtenue via réseau:", position);
            })
            .catch(error => {
                console.error("Erreur:", error);
            });
    </script>
</body>
</html> 